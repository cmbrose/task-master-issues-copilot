name: 'Taskmaster Generate'
description: 'Generate task graph and GitHub issues from PRD files'
author: 'Taskmaster Team'

inputs:
  complexity-threshold:
    description: 'Maximum complexity threshold for task breakdown'
    required: false
    default: '40'
  max-depth:
    description: 'Maximum depth for automatic task recursion'
    required: false
    default: '3'
  prd-path-glob:
    description: 'Path glob pattern for PRD files'
    required: false
    default: 'docs/**.prd.md'
  taskmaster-args:
    description: 'Additional arguments to pass to Taskmaster CLI'
    required: false
    default: ''
  github-token:
    description: 'GitHub token for API access'
    required: true

outputs:
  task-graph:
    description: 'Path to generated task graph JSON file'
  issues-created:
    description: 'Number of issues created or updated'

runs:
  using: 'composite'
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
    
    - name: Run Taskmaster Generate
      run: node ${{ github.action_path }}/dist/index.js
      shell: bash
      env:
        INPUT_COMPLEXITY-THRESHOLD: ${{ inputs.complexity-threshold }}
        INPUT_MAX-DEPTH: ${{ inputs.max-depth }}
        INPUT_PRD-PATH-GLOB: ${{ inputs.prd-path-glob }}
        INPUT_TASKMASTER-ARGS: ${{ inputs.taskmaster-args }}
        INPUT_GITHUB-TOKEN: ${{ inputs.github-token }}

branding:
  icon: 'list'
  color: 'blue'